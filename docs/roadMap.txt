HeyBridge - Slack Clone Development Roadmap
===========================================

## PHASE 1: Authentication & User Management ✅ (COMPLETED)
---------------------------------------------------------
1.1. Firebase Setup
   - ✅ Firebase Authentication (Email/Password)
   - ✅ Firestore Database
   - ✅ Firebase configuration for iOS, Android, Web

1.2. Auth Screens
   - ✅ Login Screen (Responsive - Mobile & Desktop)
   - ✅ Sign Up Screen (Responsive)
   - ✅ Password visibility toggle
   - ✅ Form validation
   - ✅ Error handling

1.3. User Model & Firestore Integration
   - ✅ UserModel (uid, email, displayName, photoURL, createdAt, lastSeen, workspaceIds)
   - ✅ FirestoreService (CRUD operations for users)
   - ✅ Auto-create user document in Firestore on registration
   - ✅ Never store passwords in Firestore

1.4. Initial Workspace Screen
   - ✅ Workspace selection screen (Create/Join workspace)
   - ✅ Logout functionality


## PHASE 2: Workspace Management ✅ (COMPLETED)
------------------------------------------------
2.1. Workspace Model & Database Structure
   - ✅ Workspace Model (id, name, description, ownerId, memberIds, channelIds, createdAt)
   - ✅ Firestore collection: workspaces/{workspaceId}
   - ✅ WorkspaceService (create, read, update, delete, join, leave)

2.2. Workspace Creation
   - ✅ Create Workspace Modal Dialog enhancement
   - ✅ Workspace name validation
   - ✅ Auto-add creator as owner and first member, with password protection option
   - ✅ Generate unique workspace ID
   - ✅ Create default #general channel

2.3. Workspace Join
   - ✅ Join Workspace Dialog enhancement
   - ✅ Invite code generation and validation
   - ✅ Add user to workspace members
   - ✅ Update user's workspaceIds array
   - ✅ Password validation for protected workspaces

2.4. Workspace List Screen
   - ✅ Display user's workspaces
   - ✅ Show member count
   - ✅ Lock icon for password-protected workspaces
   - ✅ Workspace selection (navigate to channels - pending)
   - [ ] Workspace settings icon (deferred to later)
   - [ ] User profile section at bottom (deferred to later)

2.5. Workspace Settings (Deferred to Phase 8)
   - [ ] Edit workspace name
   - [ ] Manage members (view, invite, remove)
   - [ ] Generate/regenerate invite codes
   - [ ] Delete workspace (owner only)
   - [ ] Leave workspace


## PHASE 3: Channel System ✅ (COMPLETED)
--------------------------
3.1. Channel Model & Database Structure
   - ✅ Channel Model (id, workspaceId, name, description, isPrivate, memberIds, createdBy, createdAt)
   - ✅ Firestore subcollection: workspaces/{workspaceId}/channels/{channelId}
   - ✅ ChannelService (create, read, update, delete, join, leave)

3.2. Channel List Screen (Left Sidebar - Main View)
   - ✅ Display workspace info at top
   - ✅ Search/Jump to functionality
   - ✅ Threads section (placeholder)
   - ✅ Drafts & Sent section (placeholder)
   - ✅ Mentions & Reactions section (placeholder)
   - [ ] Starred channels section (deferred to Phase 6)
   - ✅ Public channels list
   - ✅ Private channels list
   - ✅ Direct Messages list (placeholder)
   - ✅ Add channel button
   - ✅ Bottom navigation (Home, DMs, Mentions, You)

3.3. Channel Creation
   - ✅ Create channel dialog
   - ✅ Channel name validation (lowercase, no spaces, #prefix)
   - ✅ Public/Private toggle
   - ✅ Channel description
   - ✅ Auto-add creator to channel members
   - [ ] Add initial members (for private channels) (deferred to Phase 6)

3.4. Channel Settings
   - ✅ Edit channel name and description
   - [ ] Channel members list (placeholder - deferred to Phase 6)
   - [ ] Add/remove members (deferred to Phase 6)
   - ✅ Archive/delete channel
   - ✅ Leave channel
   - [ ] Notification preferences (placeholder - deferred to Phase 7)


## PHASE 4: Real-Time Messaging System ✅ (COMPLETED)
---------------------------------------
4.1. Message Model & Database Structure
   - ✅ Message Model (id, channelId, senderId, text, attachments, replyToId, reactions, createdAt, updatedAt, isEdited, isDeleted)
   - ✅ Firestore subcollection: workspaces/{workspaceId}/channels/{channelId}/messages/{messageId}
   - ✅ MessageService (send, read, update, delete, react)

4.2. Chat Screen (Main Chat Area - Center View)
   - ✅ Channel header (name, member count, description, info icon)
   - ✅ Back button (mobile)
   - ✅ Message list with real-time updates
   - ✅ Message grouping by date
   - ✅ Sender info (avatar, name, timestamp)
   - ✅ Message reactions display
   - [ ] Thread indicator (deferred to Phase 6)
   - [ ] Scroll to bottom button (deferred to Phase 8)
   - [ ] Unread message indicator (deferred to Phase 7)
   - ✅ Loading states

4.3. Message Input
   - ✅ Rich text input field
   - ✅ Placeholder text (e.g., "Message #design-team")
   - [ ] Formatting toolbar (bold, italic, code, etc.) (deferred to Phase 6)
   - [ ] @ mention autocomplete (deferred to Phase 6)
   - [ ] # channel reference autocomplete (deferred to Phase 6)
   - ✅ Emoji picker
   - [ ] File attachment button (placeholder - deferred to Phase 6)
   - ✅ Send button
   - [ ] Voice message option (deferred to Phase 9)
   - ✅ Edit mode (shows "Editing message" indicator)
   - ✅ Reply mode (shows reply preview)

4.4. Message Features
   - ✅ Send text messages
   - ✅ Edit messages (show "edited" indicator)
   - ✅ Delete messages (soft delete with "This message was deleted" placeholder)
   - ✅ Reply to messages (with quoted message preview)
   - ✅ React to messages (emoji reactions with add/remove functionality)
   - ✅ Long-press menu (Reply, Add Reaction, Copy, Edit, Delete)
   - ✅ Reaction toggle (click to add/remove reaction)
   - ✅ Visual feedback for own reactions (highlighted in blue)
   - ✅ Swipe-to-reply gesture (WhatsApp-style, 40% threshold with Reply button)
   - ✅ Copy message text (clipboard copy with feedback)
   - [ ] Share message link (deferred to Phase 6)
   - ✅ Pin important messages (pin/unpin with visual indicator)
   - [ ] Reply in thread (deferred to Phase 6)
   - ✅ Star/save messages (save/unsave with visual indicator)

4.5. Real-Time Updates
   - ✅ Stream messages from Firestore
   - [ ] Typing indicators (deferred to Phase 7)
   - [ ] Online/offline status (deferred to Phase 7)
   - [ ] Message delivery status (deferred to Phase 7)
   - [ ] Read receipts (optional) (deferred to Phase 7)
   - [ ] Push notifications for new messages (deferred to Phase 7)


## PHASE 5: Direct Messages (DMs) ✅ (COMPLETED)
----------------------------------
5.1. DM Model & Database Structure
   - ✅ DM Model (id, workspaceId, participantIds, lastMessage, lastMessageAt, unreadCounts, isArchived)
   - ✅ Firestore collection: workspaces/{workspaceId}/directMessages/{dmId}
   - ✅ Reuse Message model for DM messages
   - ✅ DMService (getOrCreate, read, update, archive, mark as read)

5.2. DM List Screen
   - ✅ Recent DMs list (sorted by last message time)
   - ✅ User avatars with placeholder for online status
   - ✅ Last message preview
   - ✅ Unread count badge
   - ✅ Empty state with illustration
   - ✅ Start new DM button
   - ✅ Archive DM option (implemented in service)
   - [ ] Search DMs (deferred to Phase 6)

5.3. DM Chat Screen
   - ✅ Dedicated DM Chat Screen (similar to Channel Chat)
   - ✅ Show participant info in header with avatar
   - ✅ 1-on-1 conversation layout
   - ✅ All message features (send, edit, delete, reply, reactions)
   - ✅ Swipe-to-reply gesture
   - ✅ Emoji picker
   - ✅ Date headers
   - ✅ Auto-mark as read when opening
   - [ ] Call buttons (voice/video) - deferred to Phase 9

5.4. Start New DM
   - ✅ User search/selection screen
   - ✅ Filter workspace members (current workspace only)
   - ✅ Search by name or email
   - ✅ Create or navigate to existing DM
   - ✅ Workspace-specific DMs (DMs tied to each workspace)
   - [ ] Support group DMs (3+ people) - deferred to Phase 9


## PHASE 6: Threading & Advanced Features
------------------------------------------
6.1. Thread System
   - [ ] Thread Model (stores thread metadata)
   - [ ] Reply-to functionality
   - [ ] Thread view (slide-in panel on desktop, new screen on mobile)
   - [ ] Thread message counter
   - [ ] Thread participants
   - [ ] "Also send to #channel" option
   - [ ] Thread notifications

6.2. Search Functionality
   - [ ] Global search (messages, files, people)
   - [ ] Search within channel
   - [ ] Search filters (from user, date range, has files)
   - [ ] Search results view
   - [ ] Recent searches

6.3. File Sharing
   - [ ] File upload (images, documents, videos)
   - [ ] Firebase Storage integration
   - [ ] Image preview in chat
   - [ ] Document viewer
   - [ ] File download
   - [ ] File size limits
   - [ ] File type restrictions

6.4. User Profile & Settings
   - [ ] User profile screen
   - [ ] Edit display name
   - [ ] Upload profile photo
   - [ ] Status/mood message
   - [ ] Notification preferences
   - [ ] Theme settings (light/dark mode)
   - [ ] Account settings
   - [ ] Logout


## PHASE 7: Notifications & Presence
-------------------------------------
7.1. Push Notifications
   - [ ] Firebase Cloud Messaging setup
   - [ ] Notification permissions
   - [ ] New message notifications
   - [ ] Mention notifications
   - [ ] DM notifications
   - [ ] Notification settings per channel
   - [ ] Mute notifications
   - [ ] Do Not Disturb mode

7.2. Presence System
   - [ ] Online/offline status
   - [ ] Last seen timestamp
   - [ ] "Active now" indicator
   - [ ] Away/Do Not Disturb status
   - [ ] Custom status messages
   - [ ] Presence in user lists


## PHASE 8: Polish & Optimization
----------------------------------
8.1. UI/UX Improvements
   - [ ] Loading states for all async operations
   - [ ] Empty states with illustrations
   - [ ] Error states with retry options
   - [ ] Skeleton loaders
   - [ ] Smooth animations and transitions
   - [ ] Haptic feedback (mobile)
   - [ ] Keyboard shortcuts (desktop)

8.2. Performance Optimization
   - [ ] Message pagination (load older messages)
   - [ ] Image caching
   - [ ] Lazy loading for user lists
   - [ ] Optimize Firestore queries
   - [ ] Debounce search inputs
   - [ ] Virtual scrolling for long message lists

8.3. Offline Support
   - [ ] Cache recent messages locally
   - [ ] Queue messages when offline
   - [ ] Sync when back online
   - [ ] Offline indicator

8.4. Security & Validation
   - [ ] Firestore security rules
   - [ ] Input sanitization
   - [ ] Rate limiting
   - [ ] User permissions (admin, member, guest)
   - [ ] Channel permissions


## PHASE 9: Advanced Features (Future)
---------------------------------------
9.1. Voice & Video Calls
   - [ ] WebRTC integration
   - [ ] 1-on-1 voice calls
   - [ ] 1-on-1 video calls
   - [ ] Group calls
   - [ ] Screen sharing

9.2. Integrations & Bots
   - [ ] Webhook support
   - [ ] Slash commands
   - [ ] Bot users
   - [ ] Third-party integrations

9.3. Enterprise Features
   - [ ] Workspace analytics
   - [ ] Message export
   - [ ] Compliance tools
   - [ ] SSO integration
   - [ ] Advanced permissions


## DATABASE STRUCTURE OVERVIEW
==============================

Firestore Collections:
----------------------

users/
  {userId}/
    - uid: string
    - email: string
    - displayName: string
    - photoURL: string?
    - createdAt: timestamp
    - lastSeen: timestamp
    - status: string (online, offline, away)
    - workspaceIds: array<string>

workspaces/
  {workspaceId}/
    - id: string
    - name: string
    - description: string
    - ownerId: string
    - memberIds: array<string>
    - channelIds: array<string>
    - inviteCode: string
    - createdAt: timestamp
    - updatedAt: timestamp

    channels/
      {channelId}/
        - id: string
        - workspaceId: string
        - name: string
        - description: string
        - isPrivate: boolean
        - memberIds: array<string>
        - createdBy: string
        - createdAt: timestamp

        messages/
          {messageId}/
            - id: string
            - channelId: string
            - senderId: string
            - text: string
            - attachments: array
            - replyToId: string?
            - reactions: map (emoji -> array<userId>)
            - createdAt: timestamp
            - updatedAt: timestamp?
            - isEdited: boolean
            - isDeleted: boolean

    directMessages/
      {dmId}/
        - id: string
        - participantIds: array<string>
        - lastMessage: string
        - lastMessageAt: timestamp
        - unreadCounts: map (userId -> count)

        messages/
          {messageId}/
            - (same structure as channel messages)


## TECH STACK
=============
- Frontend: Flutter (iOS, Android, Web)
- Backend: Firebase
  - Authentication: Firebase Auth
  - Database: Cloud Firestore
  - Storage: Firebase Storage
  - Functions: Cloud Functions (future)
  - Messaging: Firebase Cloud Messaging
- State Management: Provider
- Real-time: Firestore Streams


## DESIGN PRINCIPLES
====================
1. Responsive Design (Mobile-first, Desktop-optimized)
2. Dark Theme Primary (Light theme optional)
3. Slack-inspired UI/UX
4. Smooth Animations
5. Accessibility (screen readers, keyboard navigation)
6. Offline-first where possible
7. Real-time by default


## CURRENT PROGRESS
===================
✅ Phase 1: Complete (Auth, User Management, Initial Workspace Screen)
✅ Phase 2: Complete (Workspace Management)
✅ Phase 3: Complete (Channel System)
✅ Phase 4: Complete (Real-Time Messaging System - All core features implemented!)
   - ✅ Message send/receive with real-time updates
   - ✅ Chat bubbles with sender info and timestamps
   - ✅ Reply to messages with preview
   - ✅ Edit messages with visual indicator (null safety fix applied)
   - ✅ Delete messages (soft delete)
   - ✅ Emoji reactions (add/remove/toggle)
   - ✅ Emoji picker for messages and reactions
   - ✅ Date grouping headers
   - ✅ Long-press context menu
   - ✅ Unknown User display name fix
   - ✅ Swipe-to-reply gesture (WhatsApp-style with visible button)
✅ Phase 5: Complete (Direct Messages System - Workspace-specific DMs!)
   - ✅ DM model and service with workspace isolation
   - ✅ DM List screen with unread counts
   - ✅ DM Chat screen with all messaging features
   - ✅ New DM screen with workspace member search
   - ✅ Navigation integration
   - ✅ Firestore security rules for DMs
⏳ Phase 6-9: Planned


## NOTES
========
- Always prioritize security (never store passwords, validate inputs)
- Keep Firestore costs in mind (optimize queries, use pagination)
- Test on multiple devices and screen sizes
- Regular code reviews and refactoring
- Document all major features
- Write unit and widget tests for critical features
